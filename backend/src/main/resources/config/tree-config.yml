treeConfigs:
  POSTGRESQL:
    defaultIcon: "pgsql_icon.svg"
    defaultActions:
      primary: { label: "åˆ·æ–°", icon: "ğŸ”„", handler: "refreshNode" }
      menu:
        - { label: "å±æ€§", icon: "â„¹ï¸", handler: "showProperties" }

    nodes:
      roles_aggregate:
        parent: null
        virtual: true
        type: "roles"
        label: "Login/Group Roles"
        position: 1
        children: { users: "users_real" }
        actions:
          menu:
            - { label: "æ–°å»ºè§’è‰²", icon: "â•", handler: "createRole" }

      databases_aggregate:
        parent: null
        virtual: true
        type: "databases"
        label: "Databases"
        position: 2
        nextLevel: "dbs_real"
        actions:
          menu:
            - { label: "æ–°å»ºæ•°æ®åº“", icon: "â•", handler: "createNewDatabase" }

      dbs_real:
        parent: "databases_aggregate"
        virtual: false
        type: "database"
        sqlQuery: |
          SELECT datname AS name, datname AS id
          FROM pg_database
          WHERE datistemplate = false AND datallowconn = true
          ORDER BY datname;
        nextLevel: "db_subs_virtual"

      db_subs_virtual:
        parent: "dbs_real"
        virtual: true
        type: "db_subs"
        label: null
        icon: null
        children:
          casts: "casts_virtual"
          extensions: "extensions_virtual"
          schemas: "schemas_aggregate"

      casts_virtual:
        parent: "db_subs_virtual"
        virtual: true
        type: "casts"
        label: "Casts"
        children: {}

      extensions_virtual:
        parent: "db_subs_virtual"
        virtual: true
        type: "extensions"
        label: "Extensions"
        children: {}

      schemas_aggregate:
        parent: "db_subs_virtual"
        virtual: true
        type: "schemas"
        label: "Schemas"
        nextLevel: "schemas_real"

      schemas_real:
        parent: "schemas_aggregate"
        virtual: false
        type: "schema"
        sqlQuery: |
          SELECT
            nspname AS name,
            -- è®© id å¸¦ä¸Šæ•°æ®åº“ï¼Œä¿è¯å”¯ä¸€æ€§ & è®©åç»­ä¸Šä¸‹æ–‡å¯ä¼ é€’
            ('{parentId}' || '.' || nspname) AS id
          FROM pg_namespace
          WHERE nspname NOT IN ('pg_catalog','information_schema')
          ORDER BY nspname;
        nextLevel: "schema_subs_virtual"

      schema_subs_virtual:
        parent: "schemas_real"
        virtual: true
        type: "schema_subs"
        label: null
        icon: null
        children:
          tables: "tables_group"
          views: "views_group"
          functions: "functions_group"

      tables_group:
        parent: "schema_subs_virtual"
        virtual: true
        type: "tables"
        label: "Tables"
        nextLevel: "tables_real"

      tables_real:
        parent: "tables_group"
        virtual: false
        type: "table"
        sqlQuery: |
          SELECT
          c.relname AS name,
          -- ç»§ç»­åœ¨ id é‡Œè¿½åŠ è¡¨åï¼Œå½¢æˆ db.schema.table
          ('.' || c.relname) AS id
          FROM pg_class c
          JOIN pg_namespace n ON n.oid = c.relnamespace
          WHERE c.relkind = 'r'
          AND n.nspname = '{schemaName}'
          ORDER BY c.relname;

      views_group:
        parent: "schema_subs_virtual"
        virtual: true
        type: "views"
        label: "Views"
        nextLevel: "views_real"

      views_real:
        parent: "views_group"
        virtual: false
        type: "view"
        sqlQuery: |
          SELECT
            c.relname AS name,
            ('.' || c.relname) AS id
          FROM pg_class c
          JOIN pg_namespace n ON n.oid = c.relnamespace
          WHERE c.relkind = 'v'
            AND n.nspname = '{schemaName}'
          ORDER BY c.relname;

      functions_group:
        parent: "schema_subs_virtual"
        virtual: true
        type: "functions"
        label: "Functions"
        nextLevel: "functions_real"

      functions_real:
        parent: "functions_group"
        virtual: false
        type: "function"
        sqlQuery: |
          SELECT
          p.proname AS name,
          -- å‡½æ•°ç”¨å¸¦å‚æ•°ç­¾åå¯èƒ½é‡å¤ï¼Œè¿™é‡Œä¿æŒç®€å•ï¼šdb.schema.func
          ('.' || p.proname) AS id
          FROM pg_proc p
          JOIN pg_namespace n ON n.oid = p.pronamespace
          WHERE n.nspname = '{schemaName}'
          ORDER BY p.proname;

      users_real:
        parent: "roles_aggregate"
        virtual: false
        type: "role"
        sqlQuery: |
          SELECT rolname AS name, rolname AS id
          FROM pg_roles
          ORDER BY rolname;
