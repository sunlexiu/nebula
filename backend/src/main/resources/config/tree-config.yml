# config/tree-config.yml
# PostgreSQL æ ‘ç»“æ„é…ç½®ï¼ˆå½“å‰ä»…é’ˆå¯¹ PostgreSQLï¼Œåç»­æ‰©å±•å…¶ä»– dbTypeï¼‰
treeConfigs:
  POSTGRESQL:
    # è¿æ¥çº§åˆ«å›¾æ ‡
    icon: "pgsql_icon.svg"
    # åŸºç¡€å±‚çº§å®šä¹‰ï¼ˆä» connection å¼€å§‹ï¼Œé€å±‚å±•å¼€ï¼‰
    levels:
      # ç¬¬ä¸€å±‚ï¼šDatabases
      - type: "database"
        label: "æ•°æ®åº“"
        icon: "db_icon.svg"
        # SQL æŸ¥è¯¢æ¨¡æ¿ï¼šå ä½ç¬¦å¦‚ {connId} å°†ç”±åç«¯æ›¿æ¢ä¸ºå®é™…è¿æ¥å‚æ•°
        sqlQuery: |
          SELECT datname AS name, datname AS id
          FROM pg_database
          WHERE datistemplate = false AND datallowconn = true
          ORDER BY datname;
        # åŠ¨ä½œé…ç½®ï¼ˆprimary ä¸ºé»˜è®¤ä¸»åŠ¨ä½œï¼Œmenu ä¸ºå³é”®èœå•é¡¹ï¼‰
        actions:
          primary:
            label: "åˆ·æ–°"
            icon: "ğŸ”„"
            handler: "refreshDatabase"  # å‰ç«¯å‡½æ•°åæˆ–åç«¯ç«¯ç‚¹
          menu:
            - label: "æ–°å»º Schema"
              icon: "ğŸ“"
              handler: "createNewSchema"
            - label: "å¯¼å‡ºç»“æ„"
              icon: "ğŸ“¤"
              handler: "exportDatabase"
            - type: "separator"
            - label: "åˆ é™¤æ•°æ®åº“"
              icon: "ğŸ—‘ï¸"
              handler: "deleteDatabase"
              variant: "danger"
            - label: "å±æ€§"
              icon: "â„¹ï¸"
              handler: "showProperties"
        # ä¸‹ä¸€å±‚å¼•ç”¨
        nextLevel: "schema"
      # ç¬¬äºŒå±‚ï¼šSchemas
      - type: "schema"
        label: "Schema"
        icon: "schema_icon.svg"
        sqlQuery: |
          SELECT schema_name AS name, schema_name AS id
          FROM information_schema.schemata
          WHERE catalog_name = '{dbName}'
          ORDER BY schema_name;
        actions:
          primary:
            label: "åˆ·æ–°"
            icon: "ğŸ”„"
            handler: "refreshSchema"
          menu:
            - label: "æ–°å»ºè¡¨"
              icon: "ğŸ“Š"
              handler: "createNewTable"
            - label: "æ–°å»ºè§†å›¾"
              icon: "ğŸ‘ï¸"
              handler: "createNewView"
            - label: "æ–°å»ºå‡½æ•°"
              icon: "âš™ï¸"
              handler: "createNewFunction"
            - type: "separator"
            - label: "å¯¼å‡ºç»“æ„"
              icon: "ğŸ“¤"
              handler: "exportSchema"
            - label: "åˆ é™¤ Schema"
              icon: "ğŸ—‘ï¸"
              handler: "deleteSchema"
              variant: "danger"
            - label: "å±æ€§"
              icon: "â„¹ï¸"
              handler: "showProperties"
        nextLevel: "objects"  # æŒ‡å‘èšåˆå±‚
      # ç¬¬ä¸‰å±‚ï¼šObjectsï¼ˆèšåˆå±‚ï¼šæ”¯æŒå¤šç§å­ç±»å‹ï¼Œè‡ªåŠ¨åˆ›å»ºè™šæ‹ŸèšåˆèŠ‚ç‚¹ï¼‰
      - type: "objects"
        label: "å¯¹è±¡"
        icon: "objects_icon.svg"  # é»˜è®¤èšåˆå›¾æ ‡
        # æ— ç›´æ¥ SQLï¼Œæ­¤å±‚ä¸ºè™šæ‹Ÿèšåˆï¼Œæ ¹æ® groupBy æ‰§è¡Œå­æŸ¥è¯¢
        groupBy:  # å®šä¹‰å­ç±»å‹åˆ†ç»„ï¼Œæ¯ä¸ªåˆ†ç»„ä¸ºä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹
          # Tables åˆ†ç»„
          tables:
            type: "table_group"  # è™šæ‹ŸèšåˆèŠ‚ç‚¹ç±»å‹
            label: "Tables"  # èšåˆèŠ‚ç‚¹æ˜¾ç¤ºæ ‡ç­¾
            icon: "tables_group.svg"
            sqlQuery: |
              SELECT table_name AS name, table_name AS id, 'table' AS subType
              FROM information_schema.tables
              WHERE table_schema = '{schemaName}'  # å ä½ç¬¦ï¼šå½“å‰ schema
              AND table_type = 'BASE TABLE'
              ORDER BY table_name;
            actions:
              primary:
                label: "é¢„è§ˆ"
                icon: "ğŸ“Š"
                handler: "previewTable"
              menu: []  # èšåˆèŠ‚ç‚¹æ— é¢å¤–èœå•ï¼Œæˆ–ç»§æ‰¿å­èŠ‚ç‚¹
            # å­èŠ‚ç‚¹é…ç½®ï¼ˆæ³¨å…¥åˆ°æ¯ä¸ª table èŠ‚ç‚¹ï¼‰
            childConfig:
              type: "table"
              icon: "table_icon.svg"
              actions:
                primary:
                  label: "é¢„è§ˆæ•°æ®"
                  icon: "ğŸ“Š"
                  handler: "previewTable"
                menu:
                  - label: "ç¼–è¾‘ç»“æ„"
                    icon: "âœï¸"
                    handler: "editTableStructure"
                  - label: "ç”Ÿæˆ SQL"
                    icon: "ğŸ’¾"
                    handler: "generateTableSQL"
                  - label: "å¯¼å‡ºæ•°æ®"
                    icon: "ğŸ“¤"
                    handler: "exportTableData"
                  - type: "separator"
                  - label: "åˆ é™¤è¡¨"
                    icon: "ğŸ—‘ï¸"
                    handler: "deleteTable"
                    variant: "danger"
          # Views åˆ†ç»„
          views:
            type: "view_group"
            label: "Views"
            icon: "views_group.svg"
            sqlQuery: |
              SELECT table_name AS name, table_name AS id, 'view' AS subType
              FROM information_schema.views
              WHERE table_schema = '{schemaName}'
              ORDER BY table_name;
            actions:
              primary:
                label: "æŸ¥çœ‹å®šä¹‰"
                icon: "ğŸ‘ï¸"
                handler: "viewDefinition"
              menu: []
            childConfig:
              type: "view"
              icon: "view_icon.svg"
              actions:
                primary:
                  label: "æŸ¥çœ‹å®šä¹‰"
                  icon: "ğŸ‘ï¸"
                  handler: "viewDefinition"
                menu:
                  - label: "ç¼–è¾‘è§†å›¾"
                    icon: "âœï¸"
                    handler: "editView"
                  - label: "ç”Ÿæˆ SQL"
                    icon: "ğŸ’¾"
                    handler: "generateViewSQL"
                  - type: "separator"
                  - label: "åˆ é™¤è§†å›¾"
                    icon: "ğŸ—‘ï¸"
                    handler: "deleteView"
                    variant: "danger"
          # Materialized Views åˆ†ç»„
          materialized_views:
            type: "mview_group"
            label: "Materialized Views"
            icon: "mviews_group.svg"
            sqlQuery: |
              SELECT matviewname AS name, matviewname AS id, 'materialized_view' AS subType
              FROM pg_matviews
              WHERE schemaname = '{schemaName}'
              ORDER BY matviewname;
            actions:
              primary:
                label: "é¢„è§ˆ"
                icon: "ğŸ“Š"
                handler: "previewTable"  # å¤ç”¨ table é¢„è§ˆ
              menu: []
            childConfig:
              type: "materialized_view"
              icon: "mview_icon.svg"
              actions:
                primary:
                  label: "é¢„è§ˆæ•°æ®"
                  icon: "ğŸ“Š"
                  handler: "previewTable"
                menu:
                  - label: "åˆ·æ–°ç‰©åŒ–è§†å›¾"
                    icon: "ğŸ”„"
                    handler: "refreshMaterializedView"
                  - label: "ç¼–è¾‘ç»“æ„"
                    icon: "âœï¸"
                    handler: "editTableStructure"
                  - type: "separator"
                  - label: "åˆ é™¤ç‰©åŒ–è§†å›¾"
                    icon: "ğŸ—‘ï¸"
                    handler: "deleteView"  # å¤ç”¨ view åˆ é™¤
                    variant: "danger"
          # Functions åˆ†ç»„
          functions:
            type: "function_group"
            label: "Functions"
            icon: "functions_group.svg"
            sqlQuery: |
              SELECT p.proname AS name,
                     p.proname || '(' || pg_get_function_arguments(p.oid) || ')' AS id,
                     'function' AS subType,
                     pg_get_function_arguments(p.oid) AS args
              FROM pg_proc p
              JOIN pg_namespace n ON p.pronamespace = n.oid
              WHERE n.nspname = '{schemaName}'
              AND p.prokind = 'f'  # å‡½æ•°
              ORDER BY p.proname;
            actions:
              primary:
                label: "ç¼–è¾‘"
                icon: "âš™ï¸"
                handler: "editFunction"
              menu: []
            childConfig:
              type: "function"
              icon: "function_icon.svg"
              actions:
                primary:
                  label: "ç¼–è¾‘å‡½æ•°"
                  icon: "âœï¸"
                  handler: "editFunction"
                menu:
                  - label: "æŸ¥çœ‹æºç "
                    icon: "ğŸ‘ï¸"
                    handler: "viewFunctionSource"
                  - label: "æ‰§è¡Œæµ‹è¯•"
                    icon: "ğŸ”¬"
                    handler: "testFunction"
                  - type: "separator"
                  - label: "åˆ é™¤å‡½æ•°"
                    icon: "ğŸ—‘ï¸"
                    handler: "deleteFunction"
                    variant: "danger"
        # èšåˆå±‚é€šç”¨åŠ¨ä½œï¼ˆç»§æ‰¿åˆ°è™šæ‹ŸèŠ‚ç‚¹ï¼‰
        actions:
          primary:
            label: "å±•å¼€"
            icon: "â–¶"
            handler: "toggleExpand"
          menu:
            - label: "åˆ·æ–°"
              icon: "ğŸ”„"
              handler: "refreshObjects"
    # é¢å¤–å¯é€‰å±‚çº§ï¼ˆå…¨å±€æˆ–ç‰¹å®šä½ç½®æ’å…¥ï¼Œå¦‚åœ¨ databases æ—ï¼‰
    extraLevels:
      # Publicationsï¼ˆå…¨å±€æˆ–åœ¨ connection ä¸‹ä¸€çº§ï¼‰
      publications:
        type: "publications"
        label: "Publications"
        icon: "publications_icon.svg"
        sqlQuery: |
          SELECT pubname AS name, pubname AS id
          FROM pg_publication
          ORDER BY pubname;
        actions:
          primary:
            label: "æŸ¥çœ‹"
            icon: "ğŸ‘ï¸"
            handler: "viewPublication"
          menu:
            - label: "æ–°å»º Publication"
              icon: "â•"
              handler: "createPublication"
            - type: "separator"
            - label: "åˆ é™¤"
              icon: "ğŸ—‘ï¸"
              handler: "deletePublication"
              variant: "danger"
        # å¯ä½œä¸º connection çš„å¹¶è¡Œå­å±‚ï¼ˆéæ ‘çŠ¶åµŒå¥—ï¼‰
        position: "connection"  # æ’å…¥ä½ç½®ï¼šconnection, database ç­‰
      # Roles/Usersï¼ˆå…¨å±€ï¼‰
      roles:
        type: "roles"
        label: "Roles/Users"
        icon: "roles_icon.svg"
        sqlQuery: |
          SELECT rolname AS name, rolname AS id
          FROM pg_roles
          WHERE rolcanlogin = true  # å¯ç™»å½•ç”¨æˆ·
          ORDER BY rolname;
        actions:
          primary:
            label: "å±æ€§"
            icon: "â„¹ï¸"
            handler: "showRoleProperties"
          menu:
            - label: "æ–°å»ºè§’è‰²"
              icon: "â•"
              handler: "createRole"
            - type: "separator"
            - label: "åˆ é™¤è§’è‰²"
              icon: "ğŸ—‘ï¸"
              handler: "deleteRole"
              variant: "danger"
        position: "connection"  # æ’å…¥åˆ° connection ä¸‹ä¸€çº§